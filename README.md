# Nerdland Discord Podcast Player

A Node.js Discord bot that plays episodes of the "[Nerdland Maandoverzicht](https://podcast.nerdland.be/)" podcast directly in your Discord server.

## Features

- ðŸŽµ Play the latest Nerdland episode
- ðŸŽ² Play random episodes from the archive
- ðŸŽ¯ Search and play specific episodes with autocomplete
- â¹ï¸ Stop playback
- ðŸ“ Show episode notes and descriptions
- ðŸ”„ Auto-play random episodes when current episode ends
- ðŸ“ Plays from local MP3 files for reliable audio quality
- ðŸ¤– Auto-start playback on bot startup (when configured)

## Available Commands

- `/podcast play` - Play the latest episode of the Nerdland podcast
- `/podcast stop` - Stop the currently playing episode
- `/podcast random` - Play a random episode from the Nerdland podcast archive
- `/podcast episode` - Play a specific episode with autocomplete search
- `/podcast shownotes` - Display the show notes of the currently playing episode
- `/podcast chapters` - Display and jump to chapters of the current episode
- `/podcast ask` - Ask a question to the Nerdland Assistant (AI)

## Setup

### Prerequisites

- Node.js 18+
- Discord bot token
- FFmpeg (for audio processing)

### Installation

1. **Clone and install dependencies:**

   ```bash
   npm install
   ```

2. **Quick setup (optional):**

   ```bash
   npm run setup
   ```

   This creates a `.env` file from the template.

3. **Configure environment:**

   Edit `.env` and add your Discord bot token:

   ```
   DISCORD_TOKEN=your_discord_bot_token_here
   GUILD_ID=your_guild_id_here_optional
   VOICE_CHANNEL_ID=your_voice_channel_id_here_optional
   ```

   Optional: Set `VOICE_CHANNEL_ID` to make the bot always join a specific voice channel instead of requiring users to be in a voice channel.

4. **Create a Discord Bot:**

   - Go to [Discord Developer Portal](https://discord.com/developers/applications)
   - Create a new application and bot
   - Copy the bot token to your `.env` file
   - Enable the following bot permissions:
     - Change nickname
     - Send Messages
     - Use Slash Commands
     - Connect (to voice channels)
     - Speak (in voice channels)

5. **Invite bot to your server:**
   - In the Discord Developer Portal, go to OAuth2 > URL Generator
   - Select "bot" and "applications.commands" scopes
   - Select the required permissions
   - Use the generated URL to invite the bot

### Running the Bot

**First-time setup:**

1. **Scrape episode metadata:**

   ```bash
   npm run scrape-episodes
   ```

2. **Download episode files (Required for playback):**

   ```bash
   npm run download-episodes
   ```

   **Note:** This step is mandatory as the bot only plays from local MP3 files. SoundCloud stream URLs are temporary and only used for downloading.

3. **Start the bot:**
   ```bash
   npm start
   ```

**Regular usage:**

```bash
npm start
```

The bot will automatically start playing the latest episode if `VOICE_CHANNEL_ID` is configured in your `.env` file.

## Advanced Configuration

### Auto-Start Playback

To enable automatic playback when the bot starts:

1. Set `VOICE_CHANNEL_ID` in your `.env` file to the ID of the voice channel where the bot should auto-join
2. Set `GUILD_ID` to your server's ID for faster command registration
3. The bot will automatically join the specified voice channel and start playing the latest episode

### Episode Management

- **Episodes database**: `episodes.json` contains all episode metadata including titles, descriptions, durations, and show notes URLs
- **Local storage**: MP3 files are stored in the `downloads/` folder with timestamp-based naming
- **Auto-matching**: Local files are automatically matched with episode metadata using embedded IDs

## Project Structure

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js           # Main entry point
â”‚   â””â”€â”€ discord-bot.js     # Discord bot implementation
â”œâ”€â”€ downloads/             # Local MP3 files (ignored by git)
â”œâ”€â”€ episodes.json          # Episode metadata (generated by scripts)
â”œâ”€â”€ scripts/               # Utility scripts
â”‚   â”œâ”€â”€ scrape-episodes.js # Scrape episode metadata from SoundCloud
â”‚   â””â”€â”€ download-episodes.js # Download MP3 files from SoundCloud
â”œâ”€â”€ setup.js               # Quick setup script
â”œâ”€â”€ package.json
â”œâ”€â”€ .env.example          # Environment template
â””â”€â”€ README.md
```

## Technical Details

### Audio Sources

The bot plays audio from **local MP3 files** stored in the `downloads/` folder only.

**Important:** While SoundCloud stream URLs are collected during scraping, they are temporary and can only be used for downloading shortly after scraping. They cannot be reliably used for real-time streaming playback.

**Data Source:**
Episodes are scraped from [Lieven Scheire's SoundCloud](https://soundcloud.com/lieven-scheire) which hosts the Nerdland podcast archive.

### Episode Data

- `episodes.json` - Contains metadata for all episodes (titles, descriptions, durations, show notes, temporary stream URLs)
- Local files are matched with metadata using episode IDs
- Generated automatically by the scraping script
- **Important:** Stream URLs are temporary and only usable for downloading shortly after scraping

### Dependencies

- **discord.js** - Discord API wrapper
- **@discordjs/voice** - Voice connection handling
- **@discordjs/opus** - Audio encoding
- **ffmpeg-static** - Audio processing
- **dotenv** - Environment variable management
- **axios** - HTTP client for API requests
- **simple-json-db** - Simple JSON database for episode storage

## Usage

1. Join a voice channel in your Discord server (or configure `VOICE_CHANNEL_ID` for auto-join)
2. Use `/podcast play` to start playing the latest episode
3. Use `/podcast random` for a random episode
4. Use `/podcast episode` to search and play a specific episode
5. Use `/podcast shownotes` to see information about the current episode
6. Use `/podcast stop` to stop playback

When an episode finishes, the bot automatically plays a random episode from the archive.

## Development

### Scripts

- `npm start` - Start the bot
- `npm run setup` - Quick setup (copies .env.example to .env)
- `npm run scrape-episodes` - Scrape episode metadata and temporary stream URLs from SoundCloud
- `npm run download-episodes` - Download episode MP3 files using scraped stream URLs (required)

### Testing

Run the setup test to validate your configuration:

```bash
npm test
```

Or run the setup script to get started quickly:

```bash
npm run setup
```

## Troubleshooting

### Common Issues

1. **Bot doesn't respond to commands:**

   - Ensure the bot has the correct permissions
   - Check that slash commands are registered (happens automatically on startup)
   - Verify the bot token is correct

2. **Audio doesn't play:**

   - Ensure FFmpeg is installed and accessible
   - Check that the bot has voice permissions
   - **Required:** Run `npm run download-episodes` to ensure audio files exist locally in the downloads folder
   - Make sure you're in a voice channel or have `VOICE_CHANNEL_ID` configured
   - **Note:** Streaming from SoundCloud URLs is not supported due to temporary URL limitations

3. **No episodes available:**

   - Run `npm run scrape-episodes` to fetch episode metadata
   - **Required:** Run `npm run download-episodes` to download MP3 files locally

4. **SoundCloud scraping fails:**

   - The scraper extracts client IDs dynamically, but SoundCloud may change their structure
   - Check for network connectivity issues
   - Try running the scraper again as it has fallback mechanisms

5. **Episodes can't be downloaded:**

   - Stream URLs are temporary and expire quickly after scraping
   - Run `npm run scrape-episodes` to get fresh stream URLs, then immediately run `npm run download-episodes`
   - If downloads still fail, the stream URLs may have expired - try scraping again

6. **Bot can't join voice channel:**
   - Ensure the bot has "Connect" and "Speak" permissions
   - If using `VOICE_CHANNEL_ID`, verify the channel ID is correct
   - Check that the voice channel exists and is accessible

### Support

This bot is designed specifically for the Nerdland podcast. For general Discord bot help, refer to the [discord.js documentation](https://discord.js.org/).

## License

This project is for educational and personal use. The Nerdland podcast content belongs to its creators. This is not officially made by the Nerdland team.
